on: [push, pull_request]
jobs:
  format:
    runs-on: ubuntu-latest
    steps:
      - id: checkout
        uses: actions/checkout@v2
      - id: setup
        uses: ./.github/actions/setup
      - id: gofmt
        run: gofmt -s -l $(find . -name '*.go' -type f -print)
      - id: terraform-fmt
        run: terraform fmt -recursive -diff
  test:
    needs: [format]
    runs-on: ubuntu-latest
    steps:
      - id: checkout
        uses: actions/checkout@v2
      - id: setup
        uses: ./.github/actions/setup
      - name: go_test
        run: go test ./test/ -v -timeout 30m
